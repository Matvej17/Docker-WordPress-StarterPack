jQuery(document).ready(function(e){function s(){}(s.prototype={process:!1,is_interrupted_process:!1,in_process:!1,is_stopped:!1,is_saved:!0,is_debug:!1,status:[]}).init=function(){1==rta_data.is_debug&&(this.is_debug=!0,console.log(rta_data)),this.setStatusCodes(),this.initProcess(),this.checkSubmitReady(),e(".select, .deselect").on("click",e.proxy(this.selectAll,this)),e(document).on("change","input, select",e.proxy(this.checkSubmitReady,this)),e("#rtaform_process").on("submit",e.proxy(this.startProcess,this)),e(document).on("change",".table.imagesizes input, .table.imagesizes select",e.proxy(this.image_size_changed,this)),e(document).on("click",'button[name="save_settings"]',e.proxy(this.image_size_changed,this)),e(document).on("click",".table.imagesizes .btn_remove_row",e.proxy(this.remove_image_size_row,this)),e(document).on("click","#btn_add_image_size",e.proxy(this.add_image_size_row,this)),e(document).on("click",".stop-process",e.proxy(this.stopProcess,this)),e(document).on("click",".rta_success_box .modal-close",e.proxy(function(e){this.togglePanel("success",!1)},this)),e(document).on("change",'input[name="del_associated_thumbs"]',e.proxy(this.toggleDeleteItems,this)),e(document).on("change",'input[name^="regenerate_sizes"]',e.proxy(this.toggleDeleteItems,this)),this.toggleDeleteItems(),e(document).on("change",".rta-settings-wrap input, .rta-settings-wrap select",e.proxy(this.show_save_indicator,this)),e(document).on("change",'input[name^="regenerate_sizes"]',e.proxy(this.checkOptionsVisible,this)),e(".toggle-window").on("click",e.proxy(this.toggleWindow,this))},s.prototype.setStatusCodes=function(){},s.prototype.checkSubmitReady=function(){processReady=!0,inputs=e('input[name^="regenerate_sizes"]:checked'),!this.in_process&&this.is_saved||(processReady=!1),processReady?(e("button.rta_regenerate").removeClass("disabled"),e("button.rta_regenerate").prop("disabled",!1)):(e("button.rta_regenerate").addClass("disabled"),e("button.rta_regenerate").prop("disabled",!0)),this.is_saved?(e('button[name="save_settings"]').prop("disabled",!0),e('button[name="save_settings"]').addClass("disabled"),e(".save_note").addClass("rta_hidden")):(e('button[name="save_settings"]').prop("disabled",!1),e('button[name="save_settings"]').removeClass("disabled"),e(".save_note").removeClass("rta_hidden"))},s.prototype.initProcess=function(){process=rta_data.process,this.is_debug&&console.log(process),this.process=process,process.running&&(this.in_process=process.running),(process.running||process.preparing)&&(this.updateProgress(),this.resumeProcess())},s.prototype.selectAll=function(s){var t=e(s.target).data("action"),a=e(s.target).data("target");checked="select"==t,e('input[name^="'+a+'"]').prop("checked",checked).trigger("change")},s.prototype.startProcess=function(s){s.preventDefault(),this.resetPanels(),this.togglePanel("main",!0),this.togglePanel("loading",!0);var t=new Object;t.id=-1,t.message=rta_data.strings.status_start,t.error=!0,this.add_status([t]),this.in_process=!0,this.is_stopped=!1,this.checkSubmitReady();var a=this,i=e("#rtaform_process");e.ajax({type:"POST",dataType:"json",url:rta_data.ajaxurl,data:{nonce:rta_data.nonce_generate,action:"rta_start_process",genform:i.serialize()},success:function(e){e.status&&a.add_status(e.status),a.process=e,a.updateProgress(),a.doProcess()},error:function(e,s,t){var i=new Object;this.is_debug&&console.log(e),i.id=-1,i.message=rta_data.strings.status_fatal,i.error=!0,a.add_status([i]),a.finishProcess()}})},s.prototype.resumeProcess=function(){this.resetPanels(),this.togglePanel("main",!0),this.togglePanel("loading",!0);var e=new Object;e.id=-1,e.message=rta_data.strings.status_resume,e.error=!0,this.add_status([e]),this.doProcess()},s.prototype.doProcess=function(){if(this.togglePanel("loading",!1),!this.is_stopped){this.in_process=!0,this.checkSubmitReady(),this.togglePanel("progress",!0),this.processStoppable();var s=this;e.ajax({type:"POST",dataType:"json",url:rta_data.ajaxurl,data:{nonce:rta_data.nonce_doprocess,action:"rta_do_process",type:"submit"},success:function(e){void 0!==e.items&&(s.process=e,s.updateProgress()),e.status&&s.add_status(e.status),e.running||e.preparing?s.is_stopped||setTimeout(function(){s.doProcess()},500):s.finishProcess()},error:function(e){var t=new Object;t.id=-1,t.message=e.status+" "+e.statusText+" :: ",t.error=!0,s.add_status([t]),setTimeout(function(){s.process()},1e3)}})}},s.prototype.processStoppable=function(){var s=!1;this.in_process&&(s=!0),s?e(".stop-process").prop("disabled",!1):e(".stop-process").prop("disabled",!0)},s.prototype.finishProcess=function(){this.in_process=!1,this.is_interrupted_process=!1,this.togglePanel("success",!0),this.processStoppable();var e=new Object;e.id=-1,e.message=rta_data.strings.status_finish,e.error=!0,this.add_status([e]),this.checkSubmitReady()},s.prototype.stopProcess=function(){if(window.confirm(rta_data.strings.confirm_stop)){this.is_stopped=!0,this.togglePanel("loading",!0);var s=this;e.ajax({type:"POST",dataType:"json",url:rta_data.ajaxurl,data:{nonce:rta_data.nonce_generate,action:"rta_stop_process",type:"submit"},success:function(e){e.status&&s.add_status(e.status),s.process=!1,s.finishProcess(),s.togglePanel("loading",!1)}})}},s.prototype.updateProgress=function(s){if(this.process){var t=parseInt(this.process.items),a=parseInt(this.process.done),i=t+a,o=(this.process.errors,289.027);(s=0==a&&i>0?0:i>0?Math.round(a/i*100):100)>0&&(o=Math.round(o-o*s/100)),e(".CircularProgressbar-path").css("stroke-dashoffset",o+"px"),e(".CircularProgressbar-text").html(s+"%"),e(".progress-count .current").text(a),e(".progress-count .total").text(i)}},s.prototype.togglePanel=function(s,t){var a;switch(s){case"main":a="section.regenerate";break;case"loading":a=".rta_wait_loader";break;case"progress":a=".rta_progress_view";break;case"thumbnail":a=".rta_thumbnail_view";break;case"success":a=".rta_success_box";break;case"notices":a=".rta_notices"}var i=e(a).is(":visible");i&&0==e(a).css("opacity")&&(i=!1),t&&!i?e(a).hasClass("rta_hidden")?e(a).slideDown():e(a).css("opacity",1):!t&&i&&(e(a).hasClass("rta_hidden")?e(a).hide():e(a).css("opacity",0))},s.prototype.resetPanels=function(){this.togglePanel("loading",!1),this.togglePanel("progress",!1),this.togglePanel("thumbnail",!1),this.togglePanel("success",!1),this.togglePanel("notices",!1),e(".rta_notices .statuslist li").remove()},s.prototype.add_status=function(s){if(this.togglePanel("notices",!0),""!=s){for(var t="",a=0;a<s.length;a++){var i=s[a],o="";o=i.error?"error":"",1!=i.status?t=t+'<li class="list-group-item '+o+'">'+i.message+"</li>":this.showThumb(i.message)}e(".rta_status_box ul.statuslist").append(t)}},s.prototype.showThumb=function(s){this.togglePanel("thumbnail",!0),e(".rta_progress .images img").attr("src",s)},s.prototype.add_image_size_row=function(){var e=jQuery,s=e(".table.imagesizes"),t=Math.random().toString(36).substring(2)+(new Date).getTime().toString(36),a=e(".row.proto").clone();e(a).attr("id",t),e(a).removeClass("proto"),s.append(a),s.find(".header").removeClass("rta_hidden")},s.prototype.image_size_changed=function(s){s.preventDefault();var t=e(s.target).parents(".row").attr("id");this.update_thumb_name(t),this.save_image_sizes()},s.prototype.update_thumb_name=function(s){if(e("#"+s).length){var t=e("#"+s+" .image_sizes_name").val(),a=e("#"+s+" .image_sizes_width").val(),i=e("#"+s+" .image_sizes_height").val(),o=e("#"+s+" .image_sizes_cropping").val(),r=e("#"+s+" .image_sizes_pname").val();a<=0&&(a=""),i<=0&&(i="");var n=("rta_thumb "+o+" "+a+"x"+i).toLowerCase().replace(/ /g,"_");e('input[name^="regenerate_sizes"][value="'+t+'"]').val(n),r.length<=0&&e('input[name^="regenerate_sizes"][value="'+t+'"]').text(n),e('input[name="keep_'+t+'"]').attr("name","keep_"+n),e("#"+s+" .image_sizes_name").val(n)}},s.prototype.save_image_sizes=function(){this.settings_doingsave_indicator(!0);var s=rta_data.nonce_savesizes,t=this;e.ajax({type:"POST",dataType:"json",url:rta_data.ajaxurl,data:{action:"rta_save_image_sizes",save_nonce:s,saveform:e("#rta_settings_form").serialize()},success:function(s){s.error||s.new_image_sizes&&(e(".thumbnail_select .checkbox-list").fadeOut(80).html(s.new_image_sizes).fadeIn(80),t.checkOptionsVisible()),t.is_saved=!0,t.settings_doingsave_indicator(!1),t.checkSubmitReady(),t.toggleDeleteItems()}})},s.prototype.settings_doingsave_indicator=function(s){s?e(".form_controls .save_indicator").fadeIn(20):e(".form_controls .save_indicator").fadeOut(100)},s.prototype.show_save_indicator=function(){this.is_saved=!1,this.checkSubmitReady()},s.prototype.remove_image_size_row=function(s){var t=e(s.target).parents(".row").attr("id");if(confirm(rta_data.strings.confirm_delete)){var a=e("#"+t).find(".image_sizes_name").val();e('input[name^="regenerate_sizes"][value="'+a+'"]').remove(),e("#"+t).remove(),this.save_image_sizes()}},s.prototype.checkOptionsVisible=function(){e('input[name^="regenerate_sizes"]').each(function(){if(e(this).is(":checked")){e(this).parents(".item").find(".options").removeClass("hidden");var s=e(this).parents(".item").find('input[type="checkbox"]');void 0===e(s).data("setbyuser")&&(e(s).prop("checked",!0),e(s).data("setbyuser",!0))}else e(this).parents(".item").find(".options").addClass("hidden")})},s.prototype.toggleDeleteItems=function(){e(".checkbox-list label").removeClass("warning-removal"),e(".checkbox-list .icon-warning").remove();var s=e('input[name="del_associated_thumbs"]');if(e(s).is(":checked")){var t=!1;e('input[name^="regenerate_sizes"]').not(":checked").each(function(){e(this).parent("label").addClass("warning-removal"),e(this).parent("label").find("input").before("<span class='dashicons dashicons-no icon-warning'></span>"),t=!0}),t&&e("#warn-delete-items").removeClass("rta_hidden")}else e("#warn-delete-items").addClass("rta_hidden")},s.prototype.toggleWindow=function(s){var t=e(s.target);t.hasClass("toggle-window")||(t=e(s.target).parents(".toggle-window"));var a=e("#"+t.data("window"));a.hasClass("window-up")?(a.removeClass("window-up").addClass("window-down"),t.find("span.dashicons").removeClass("dashicons-arrow-down").addClass("dashicons-arrow-up")):(a.removeClass("window-down").addClass("window-up"),t.find("span.dashicons").addClass("dashicons-arrow-down").removeClass("dashicons-arrow-up"))},window.rtaJS=new s,window.rtaJS.init()});